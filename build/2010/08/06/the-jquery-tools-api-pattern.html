<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1">
<!-- Google Setup --><meta content="VbyiHsqFIT6NSIBRNw/TAnm+9zy0TAmFRiC68lYCoSw=" name="verify-v1">
<!-- OpenID Setup --><link href="http://www.myopenid.com/server" rel="openid.server">
<link href="http://tdreyno.myopenid.com/" rel="openid.delegate">
<link href="http://tdreyno.myopenid.com" rel="openid2.local_id">
<link href="http://www.myopenid.com/server" rel="openid2.provider">
<meta content="http://www.myopenid.com/xrds?username=tdreyno.myopenid.com" http-equiv="X-XRDS-Location">
<title>The jQuery Tools API Pattern Â« Thomas Reynolds</title>
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]--><!-- Stylesheet --><link rel="stylesheet" type="text/css" href="/stylesheets/style.css?v2">
<!-- RSS --><link href="http://feeds2.feedburner.com/awf-allposts" rel="alternate" title="Award Winning Fjords" type="application/rss+xml">
<script src="/javascripts/modernizr.custom.js" type="text/javascript"></script><script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.js"></script><!--script type="text/javascript" src="/javascripts/jqwidont.js"></script-->
</head>
<body class="post">
    <header><div class="center">
        <h1><a href="/">Award-Winning Fjords</a></h1>
        <h2 class="byline author vcard">
          Words &amp; Wisdom by 
          <span class="fn">Thomas Reynolds</span>
        </h2>

        <p id="social">
          <a href="http://github.com/tdreyno">GitHub</a>, <a href="http://twitter.com/tdreyno">Twitter</a> &amp; <a href="http://portfolio.awardwinningfjords.com">Portfolio</a><br><a id="contact" href="mailto:me@tdreyno.com">Contact me</a>
        </p>
      </div>
    </header><div id="frame">
      <div id="post">
        
          
          <article class="hentry"><h1 class="entry-title">
    The jQuery Tools API Pattern 
    <time class="updated" pubdate>Aug  6 2010</time>
</h1>

  <!--div id='rdbWrapper' style="float: right; display: inline; width: 150px; height: 50px;"></div><br clear="all" /><script type='text/javascript'>
  (function() {
      var s     = document.getElementsByTagName('script')[0],
          rdb   = document.createElement('script');
      rdb.type  = 'text/javascript';
      rdb.async = true;
      rdb.src   = document.location.protocol + '//www.readability.com/embed.js';
      s.parentNode.insertBefore(rdb, s);
  })();
  </script-->
  
  <div class="entry-content">
    <p>A common pattern for initializing jQuery plugins is by selecting all the instances of the target in the DOM and running the plugin once. For example:</p>

<pre class="CodeRay"><span class="pd">$</span>(<span class="s"><span class="dl">"</span><span class="k">:input</span><span class="dl">"</span></span>).myPlugin();
</pre>

<p>But what if you need to inspect the plugin later or are only interested in one instance of the plugin. A friend of mine <a href="http://forum.jquery.com/topic/return-customized-default-values-for-each-in-a-plugin">recently asked this question</a> and my suggestion was to look at the way the <a href="http://flowplayer.org/tools/">jQuery Tools</a> project does it. For each of their plugins, they build an API object which only interacts with one specific element and they attach it to the element once the plugin has been initialized using the jQuery.data method. This also provides a clean way of checking if the plugin has already been initialized on a specific element.</p>

<p>Here's how they run their scrollable plugin when called by jQuery:</p>

<pre class="CodeRay">  <span class="c">// jQuery plugin implementation</span>
  <span class="pd">$</span>.fn.<span class="fu">scrollable</span> = <span class="kw">function</span>(conf) { 

      <span class="c">// already constructed --&gt; return API</span>
      <span class="kw">var</span> el = <span class="lv">this</span>.data(<span class="s"><span class="dl">"</span><span class="k">scrollable</span><span class="dl">"</span></span>);
      <span class="kw">if</span> (el) { <span class="kw">return</span> el; }         

      conf = <span class="pd">$</span>.extend({}, <span class="pd">$</span>.tools.scrollable.conf, conf); 

      <span class="lv">this</span>.each(<span class="kw">function</span>() {            
          el = <span class="kw">new</span> Scrollable(<span class="pd">$</span>(<span class="lv">this</span>), conf);
          <span class="pd">$</span>(<span class="lv">this</span>).data(<span class="s"><span class="dl">"</span><span class="k">scrollable</span><span class="dl">"</span></span>, el);   
      });

      <span class="kw">return</span> conf.api ? el: <span class="lv">this</span>; 

  };
</pre>

<p>The <tt>Scrollable</tt> function handles plugin initialization on a per-element basis and returns scoped methods for interacting with that object. Its implementation looks like this:</p>

<pre class="CodeRay">  <span class="kw">function</span> <span class="fu">Scrollable</span>(root, conf) {   
      <span class="c">// Setup variables</span>

      <span class="c">// methods</span>
      <span class="pd">$</span>.extend(self, {
          <span class="fu">getConf</span>: <span class="kw">function</span>() {
              <span class="kw">return</span> conf;  
          },            
        <span class="c">// et cetera</span>
      });

      <span class="c">// callbacks  </span>
      <span class="pd">$</span>.each([<span class="s"><span class="dl">'</span><span class="k">onBeforeSeek</span><span class="dl">'</span></span>, <span class="s"><span class="dl">'</span><span class="k">onSeek</span><span class="dl">'</span></span>, <span class="s"><span class="dl">'</span><span class="k">onAddItem</span><span class="dl">'</span></span>], <span class="kw">function</span>(i, name) {

          <span class="c">// configuration</span>
          <span class="kw">if</span> (<span class="pd">$</span>.isFunction(conf[name])) { 
              <span class="pd">$</span>(self).bind(name, conf[name]); 
          }

          self[name] = <span class="kw">function</span>(fn) {
              <span class="pd">$</span>(self).bind(name, fn);
              <span class="kw">return</span> self;
          };
      });  

      <span class="c">// run methods</span>
    }
</pre>

<p>Now, let's assume we have applied this pattern to our <tt>myPlugin</tt> plugin. The interaction would look like this.</p>

<pre class="CodeRay"><span class="pd">$</span>(<span class="s"><span class="dl">"</span><span class="k">:input</span><span class="dl">"</span></span>).myPlugin();

<span class="kw">var</span> specificInput = <span class="pd">$</span>(<span class="s"><span class="dl">"</span><span class="k">#myinput</span><span class="dl">"</span></span>);
<span class="kw">var</span> api = specificInput.data(<span class="s"><span class="dl">"</span><span class="k">myPlugin</span><span class="dl">"</span></span>);

api.getConf()     <span class="c">// See the original config variables</span>
api.doSomething() <span class="c">// run some code</span>
api.destroy()     <span class="c">// remove the plugin</span>

<span class="c">// Run a callback on this specific instance</span>
api.onClick(<span class="kw">function</span>() { 
  <span class="c">// Click handler</span>
});
</pre>

<p>The pattern would also handle accidently running the plugin twice on a single element. For example, in the following script the plugin would only initialize the <tt>#myinput</tt> element once:</p>

<pre class="CodeRay"><span class="pd">$</span>(<span class="s"><span class="dl">"</span><span class="k">#myinput</span><span class="dl">"</span></span>).myPlugin();
<span class="pd">$</span>(<span class="s"><span class="dl">"</span><span class="k">:input</span><span class="dl">"</span></span>).myPlugin();
</pre>

<p>The <a href="http://flowplayer.org/tools/documentation/scripting.html#api">full jQuery Tools API documentation</a> is available on their website.</p>

  </div>
</article><div id="comments">
  <div class="block">
    <h2>Comments</h2>

    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style ">
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
      <a class="addthis_button_tweet"></a>
    </div>
    <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#username=xa-4d1d09583a6522e4"></script><!-- AddThis Button END -->
</div>
  
  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'awf';

      // var disqus_identifier = 'unique_dynamic_id_1234';
      var disqus_url = 'http://example.org/2010/08/06/the-jquery-tools-api-pattern.html';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
</div>

        
      </div>
      <aside id="previously"><p>My name is Thomas Reynolds. I'm a developer at <a href="http://metalabdesign.com">Metalab</a>, lucky denizen of Portland, active Crossfitter, a foodie, a cocktail enthusiast and all-around nerd.</p>
        
        <h2>
          Projects
          <a href="http://github.com/tdreyno">GitHub</a>
        </h2>
        <ol>
<li><a href="https://github.com/tdreyno/middleman">Middleman</a></li>
          <li><a href="https://github.com/tdreyno/iphone-style-checkboxes">iPhone-style Checkboxes</a></li>
          <li><a href="http://secondstory.github.com/secondstoryjs-statemachine/">State Machine for JavascriptMVC</a></li>
          <li><a href="http://secondstory.github.com/secondstoryjs-router/">Router for JavascriptMVC</a></li>
          <li><a href="https://github.com/tdreyno/mustache-javascriptmvc">Mustache templates for JavascriptMVC</a></li>
          <li><a href="http://secondstory.github.com/jqueryChop/">jQuery Image Chop</a></li>
          <li><a href="https://github.com/tdreyno/javascriptmvc-pure">Pure templates for JavascriptMVC</a></li>
          <li><a href="https://github.com/tdreyno/compass-slickmap">Slickmap for Compass</a></li>
          <li><a href="https://github.com/tdreyno/compass-baseline">Baseline for Compass</a></li>
        </ol>
<h2>
          Recent Articles
          <a href="/archives">Archive</a>
        </h2>
        <ol>
<li>
<a href="/2011/05/13/coffeescript-specific-style-guide.html">CoffeeScript-specific Style Guide</a> <span>May 13</span>
</li>
          
            <li>
<a href="/2011/05/09/javascript-microframeworks-and-the-future.html">Javascript Microframeworks and The Future</a> <span>May  9</span>
</li>
          
            <li>
<a href="/2011/05/06/trigger-css3-animations-with-jquery.html">Trigger CSS3 Animations with jQuery</a> <span>May  6</span>
</li>
          
            <li>
<a href="/2011/05/03/jquerydeferred-image-preloader.html">jQuery.Deferred Image Preloader</a> <span>May  3</span>
</li>
          
            <li>
<a href="/2011/04/26/just-launched-pixelunion-v2.html">Just Launched: PixelUnion v2</a> <span>Apr 26</span>
</li>
          
            <li>
<a href="/2011/04/26/just-give-a-damn-about-something.html">Just Give a Damn About Something</a> <span>Apr 26</span>
</li>
          
            <li>
<a href="/2011/04/24/crossfit-is-for-nerds.html">CrossFit is for Nerds</a> <span>Apr 24</span>
</li>
          
            <li>
<a href="/2011/04/23/branching-out-opening-up-and-publishing-more.html">Branching Out, Opening Up and Publishing More</a> <span>Apr 23</span>
</li>
          
            <li>
<a href="/2011/04/15/middleman-v11.html">Middleman v1.1</a> <span>Apr 15</span>
</li>
          
            <li>
<a href="/2011/04/13/adjustable-animations-with-sliders.html">Adjustable Animations with Sliders</a> <span>Apr 13</span>
</li>
          
        
      </ol></aside>
</div>
    
    <script type="text/javascript">
      (function() {
        var t   = document.createElement('script');
        t.type  = 'text/javascript';
        t.async = true;
        t.id    = 'gauges-tracker';
        t.setAttribute('data-site-id', '4d770721192b0c4ab6000002');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script><!-- Google Analytics --><script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-90027-9']);
      _gaq.push(['_trackPageview']);
      _gaq.push(['_trackPageLoadTime']);

      (function() {
      var ga = document.createElement('script');
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 
        'http://www') + '.google-analytics.com/ga.js';
      ga.setAttribute('async', 'true');
      document.documentElement.firstChild.appendChild(ga);
      })();
    </script>
</body>
</html>
